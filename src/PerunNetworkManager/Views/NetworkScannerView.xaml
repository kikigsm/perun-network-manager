<UserControl x:Class="PerunNetworkManager.Views.NetworkScannerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:models="clr-namespace:PerunNetworkManager.Core.Models;assembly=PerunNetworkManager.Core"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1200">

    <UserControl.Resources>
        <!-- Device Status Converter -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        
        <!-- Device Type Icon Converter -->
        <DataTemplate x:Key="DeviceTypeIconTemplate">
            <materialDesign:PackIcon>
                <materialDesign:PackIcon.Style>
                    <Style TargetType="materialDesign:PackIcon">
                        <Setter Property="Kind" Value="HelpCircle" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding DeviceType}" Value="Computer">
                                <Setter Property="Kind" Value="Monitor" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding DeviceType}" Value="Router">
                                <Setter Property="Kind" Value="Router" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding DeviceType}" Value="Switch">
                                <Setter Property="Kind" Value="Switch" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding DeviceType}" Value="Printer">
                                <Setter Property="Kind" Value="Printer" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding DeviceType}" Value="Mobile">
                                <Setter Property="Kind" Value="Cellphone" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding DeviceType}" Value="Server">
                                <Setter Property="Kind" Value="Server" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding DeviceType}" Value="Camera">
                                <Setter Property="Kind" Value="Camera" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding DeviceType}" Value="SmartTV">
                                <Setter Property="Kind" Value="Television" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding DeviceType}" Value="IoT">
                                <Setter Property="Kind" Value="Home" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </materialDesign:PackIcon.Style>
            </materialDesign:PackIcon>
        </DataTemplate>

        <!-- Device Status Color Converter -->
        <Style x:Key="DeviceStatusStyle" TargetType="Ellipse">
            <Setter Property="Fill" Value="Gray" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="Online">
                    <Setter Property="Fill" Value="Green" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Offline">
                    <Setter Property="Fill" Value="Red" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsReachable}" Value="True">
                    <Setter Property="Fill" Value="LightGreen" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <materialDesign:ColorZone Grid.Row="0" Mode="PrimaryMid" Padding="15,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Radar" 
                                           VerticalAlignment="Center" 
                                           Foreground="White" 
                                           Width="24" Height="24" 
                                           Margin="0,0,10,0" />
                    <TextBlock Text="Network Scanner" 
                             FontSize="18" FontWeight="SemiBold" 
                             Foreground="White" VerticalAlignment="Center" />
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Command="{Binding RefreshCommand}"
                            Style="{StaticResource MaterialDesignIconButton}"
                            ToolTip="Refresh Subnets">
                        <materialDesign:PackIcon Kind="Refresh" Foreground="White" />
                    </Button>
                    <Button Command="{Binding ExportResultsCommand}"
                            Style="{StaticResource MaterialDesignIconButton}"
                            ToolTip="Export Results">
                        <materialDesign:PackIcon Kind="Export" Foreground="White" />
                    </Button>
                </StackPanel>
            </Grid>
        </materialDesign:ColorZone>

        <!-- Scan Configuration -->
        <materialDesign:Card Grid.Row="1" Margin="10" Padding="15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Subnet Selection -->
                <Grid Grid.Row="0" Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="200" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="Target Subnet:" 
                             VerticalAlignment="Center" 
                             FontWeight="SemiBold" 
                             Margin="0,0,10,0" />
                    
                    <ComboBox Grid.Column="1" 
                            ItemsSource="{Binding AvailableSubnets}"
                            SelectedItem="{Binding SelectedSubnet}"
                            DisplayMemberPath="NetworkRange"
                            Margin="0,0,15,0"
                            materialDesign:HintAssist.Hint="Select discovered subnet" />
                    
                    <TextBlock Grid.Column="2" Text="or Custom Range:" 
                             VerticalAlignment="Center" 
                             Margin="0,0,10,0" />
                    
                    <TextBox Grid.Column="3" 
                           Text="{Binding CustomSubnetRange, UpdateSourceTrigger=PropertyChanged}"
                           materialDesign:HintAssist.Hint="192.168.1.0/24"
                           Margin="0,0,15,0" />
                    
                    <Button Grid.Column="4" 
                          Command="{Binding DiscoverSubnetsCommand}"
                          Content="Discover"
                          Style="{StaticResource MaterialDesignOutlinedButton}" />
                </Grid>

                <!-- Scan Options -->
                <Expander Grid.Row="1" Header="Scan Options" Margin="0,0,0,15">
                    <Grid Margin="20,10,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- Basic Options -->
                        <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,15,10">
                            <CheckBox Content="Resolve Hostnames" 
                                    IsChecked="{Binding ScanOptions.ResolveHostnames}" 
                                    Margin="0,5" />
                            <CheckBox Content="Resolve NetBIOS Names" 
                                    IsChecked="{Binding ScanOptions.ResolveNetBios}" 
                                    Margin="0,5" />
                            <CheckBox Content="Resolve Vendors" 
                                    IsChecked="{Binding ScanOptions.ResolveVendors}" 
                                    Margin="0,5" />
                        </StackPanel>

                        <!-- Advanced Options -->
                        <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,15,10">
                            <CheckBox Content="Enable Port Scanning" 
                                    IsChecked="{Binding ScanOptions.EnablePortScan}" 
                                    Margin="0,5" />
                            <CheckBox Content="Detect Operating System" 
                                    IsChecked="{Binding ScanOptions.DetectOS}" 
                                    Margin="0,5" />
                        </StackPanel>

                        <!-- Timeouts -->
                        <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,0,10">
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Ping Timeout:" VerticalAlignment="Center" />
                                <Slider Grid.Column="1" 
                                      Value="{Binding ScanOptions.PingTimeout}" 
                                      Minimum="500" Maximum="5000" 
                                      TickFrequency="500" 
                                      Margin="10,0" />
                                <TextBlock Grid.Column="2" 
                                         Text="{Binding ScanOptions.PingTimeout, StringFormat={}{0}ms}" 
                                         VerticalAlignment="Center" />
                            </Grid>
                            
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Max Threads:" VerticalAlignment="Center" />
                                <Slider Grid.Column="1" 
                                      Value="{Binding ScanOptions.MaxConcurrentPings}" 
                                      Minimum="10" Maximum="100" 
                                      TickFrequency="10" 
                                      Margin="10,0" />
                                <TextBlock Grid.Column="2" 
                                         Text="{Binding ScanOptions.MaxConcurrentPings}" 
                                         VerticalAlignment="Center" />
                            </Grid>
                        </StackPanel>
                    </Grid>
                </Expander>

                <!-- Scan Controls and Progress -->
                <Grid Grid.Row="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0" 
                          Command="{Binding StartScanCommand}"
                          Content="Start Scan"
                          Style="{StaticResource MaterialDesignRaisedButton}"
                          Background="#1E3A8A"
                          Margin="0,0,10,0" />
                    
                    <Button Grid.Column="1" 
                          Command="{Binding StopScanCommand}"
                          Content="Stop"
                          Style="{StaticResource MaterialDesignOutlinedButton}"
                          Margin="0,0,15,0" />

                    <!-- Progress Info -->
                    <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="0,0,15,0">
                        <TextBlock Text="{Binding ScanStatusText}" FontWeight="SemiBold" />
                        <ProgressBar Value="{Binding ScanProgress}" 
                                   Maximum="100" 
                                   Height="4" 
                                   Margin="0,5,0,0"
                                   Visibility="{Binding IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}" />
                    </StackPanel>

                    <TextBlock Grid.Column="3" 
                             VerticalAlignment="Center" 
                             Margin="0,0,15,0">
                        <Run Text="Devices: " />
                        <Run Text="{Binding DiscoveredCount, Mode=OneWay}" FontWeight="Bold" />
                        <Run Text=" | Scanned: " />
                        <Run Text="{Binding ScannedHosts, Mode=OneWay}" FontWeight="Bold" />
                        <Run Text="/" />
                        <Run Text="{Binding TotalHosts, Mode=OneWay}" FontWeight="Bold" />
                    </TextBlock>

                    <Button Grid.Column="4" 
                          Command="{Binding ClearResultsCommand}"
                          Content="Clear"
                          Style="{StaticResource MaterialDesignOutlinedButton}" />
                </Grid>
            </Grid>
        </materialDesign:Card>

        <!-- Results -->
        <Grid Grid.Row="2" Margin="10,0,10,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="5" />
                <ColumnDefinition Width="300" MinWidth="250" />
            </Grid.ColumnDefinitions>

            <!-- Device List -->
            <materialDesign:Card Grid.Column="0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Filter Header -->
                    <materialDesign:ColorZone Grid.Row="0" Mode="PrimaryLight" Padding="15,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0" Text="Discovered Devices" 
                                     FontSize="16" FontWeight="SemiBold" 
                                     VerticalAlignment="Center" />
                            
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <TextBlock Text="{Binding FilteredDevices.Count, StringFormat='({0} shown)'}" 
                                         VerticalAlignment="Center" 
                                         Margin="0,0,10,0" />
                            </StackPanel>
                        </Grid>
                    </materialDesign:ColorZone>

                    <!-- Filters -->
                    <Grid Grid.Row="1" Margin="15,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="150" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBox Grid.Column="0" 
                               Text="{Binding DeviceFilterText, UpdateSourceTrigger=PropertyChanged}"
                               materialDesign:HintAssist.Hint="Filter by IP, hostname, MAC, or vendor..."
                               materialDesign:TextFieldAssist.HasLeadingIcon="True"
                               materialDesign:TextFieldAssist.LeadingIcon="Magnify"
                               Margin="0,0,10,0" />

                        <ComboBox Grid.Column="1" 
                                SelectedItem="{Binding SelectedDeviceTypeFilter}"
                                materialDesign:HintAssist.Hint="Device Type"
                                Margin="0,0,10,0">
                            <ComboBox.ItemsSource>
                                <x:Array Type="models:DeviceType">
                                    <models:DeviceType>Unknown</models:DeviceType>
                                    <models:DeviceType>Computer</models:DeviceType>
                                    <models:DeviceType>Server</models:DeviceType>
                                    <models:DeviceType>Router</models:DeviceType>
                                    <models:DeviceType>Switch</models:DeviceType>
                                    <models:DeviceType>Printer</models:DeviceType>
                                    <models:DeviceType>Mobile</models:DeviceType>
                                    <models:DeviceType>IoT</models:DeviceType>
                                    <models:DeviceType>Camera</models:DeviceType>
                                    <models:DeviceType>SmartTV</models:DeviceType>
                                </x:Array>
                            </ComboBox.ItemsSource>
                        </ComboBox>

                        <CheckBox Grid.Column="2" 
                                Content="Online Only" 
                                IsChecked="{Binding ShowOnlineOnly}" />
                    </Grid>

                    <!-- Device DataGrid -->
                    <DataGrid Grid.Row="2" 
                            ItemsSource="{Binding FilteredDevices}"
                            SelectedItem="{Binding SelectedDevice}"
                            AutoGenerateColumns="False"
                            CanUserAddRows="False"
                            CanUserDeleteRows="False"
                            IsReadOnly="True"
                            GridLinesVisibility="Horizontal"
                            HeadersVisibility="Column"
                            Margin="15,0,15,15">
                        
                        <DataGrid.Columns>
                            <!-- Status -->
                            <DataGridTemplateColumn Header="Status" Width="60">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Ellipse Width="12" Height="12" 
                                                   Style="{StaticResource DeviceStatusStyle}" />
                                            <materialDesign:PackIcon Kind="Star" 
                                                                   Width="8" Height="8" 
                                                                   Foreground="Gold"
                                                                   Visibility="{Binding IsWatched, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- Device Type Icon -->
                            <DataGridTemplateColumn Header="Type" Width="50">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <ContentPresenter Content="{Binding}" 
                                                        ContentTemplate="{StaticResource DeviceTypeIconTemplate}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- IP Address -->
                            <DataGridTextColumn Header="IP Address" 
                                              Binding="{Binding IPAddressString}" 
                                              Width="120" />

                            <!-- Hostname -->
                            <DataGridTextColumn Header="Hostname" 
                                              Binding="{Binding HostName}" 
                                              Width="150" />

                            <!-- MAC Address -->
                            <DataGridTextColumn Header="MAC Address" 
                                              Binding="{Binding MacAddress}" 
                                              Width="140" />

                            <!-- Vendor -->
                            <DataGridTextColumn Header="Vendor" 
                                              Binding="{Binding Vendor}" 
                                              Width="120" />

                            <!-- Response Time -->
                            <DataGridTextColumn Header="Response" 
                                              Binding="{Binding ResponseTimeText}" 
                                              Width="80" />

                            <!-- Open Ports -->
                            <DataGridTemplateColumn Header="Ports" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding OpenPorts.Count, StringFormat='{0} open'}" 
                                                 ToolTip="{Binding OpenPorts}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- Actions -->
                            <DataGridTemplateColumn Header="Actions" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Command="{Binding DataContext.PingDeviceCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                  CommandParameter="{Binding}"
                                                  Style="{StaticResource MaterialDesignIconButton}"
                                                  ToolTip="Ping Device"
                                                  Width="24" Height="24">
                                                <materialDesign:PackIcon Kind="Pulse" Width="16" Height="16" />
                                            </Button>
                                            
                                            <Button Command="{Binding DataContext.WakeOnLanCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                  CommandParameter="{Binding}"
                                                  Style="{StaticResource MaterialDesignIconButton}"
                                                  ToolTip="Wake on LAN"
                                                  Width="24" Height="24">
                                                <materialDesign:PackIcon Kind="PowerOn" Width="16" Height="16" />
                                            </Button>
                                            
                                            <Button Command="{Binding DataContext.ShowDeviceDetailsCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                  CommandParameter="{Binding}"
                                                  Style="{StaticResource MaterialDesignIconButton}"
                                                  ToolTip="Device Details"
                                                  Width="24" Height="24">
                                                <materialDesign:PackIcon Kind="InformationOutline" Width="16" Height="16" />
                                            </Button>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>

                        <DataGrid.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Ping Device" 
                                        Command="{Binding PingDeviceCommand}"
                                        CommandParameter="{Binding SelectedDevice}">
                                    <MenuItem.Icon>
                                        <materialDesign:PackIcon Kind="Pulse" />
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Traceroute" 
                                        Command="{Binding TraceRouteCommand}"
                                        CommandParameter="{Binding SelectedDevice}">
                                    <MenuItem.Icon>
                                        <materialDesign:PackIcon Kind="MapMarkerPath" />
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Port Scan" 
                                        Command="{Binding PortScanCommand}"
                                        CommandParameter="{Binding SelectedDevice}">
                                    <MenuItem.Icon>
                                        <materialDesign:PackIcon Kind="LanConnect" />
                                    </MenuItem.Icon>
                                </MenuItem>
                                <Separator />
                                <MenuItem Header="Wake on LAN" 
                                        Command="{Binding WakeOnLanCommand}"
                                        CommandParameter="{Binding SelectedDevice}">
                                    <MenuItem.Icon>
                                        <materialDesign:PackIcon Kind="PowerOn" />
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Rescan Device" 
                                        Command="{Binding RescanDeviceCommand}"
                                        CommandParameter="{Binding SelectedDevice}">
                                    <MenuItem.Icon>
                                        <materialDesign:PackIcon Kind="Refresh" />
                                    </MenuItem.Icon>
                                </MenuItem>
                                <Separator />
                                <MenuItem Header="Add to Watch List" 
                                        Command="{Binding AddToWatchListCommand}"
                                        CommandParameter="{Binding SelectedDevice}">
                                    <MenuItem.Icon>
                                        <materialDesign:PackIcon Kind="Star" />
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Remove from Watch List" 
                                        Command="{Binding RemoveFromWatchListCommand}"
                                        CommandParameter="{Binding SelectedDevice}">
                                    <MenuItem.Icon>
                                        <materialDesign:PackIcon Kind="StarOff" />
                                    </MenuItem.Icon>
                                </MenuItem>
                                <Separator />
                                <MenuItem Header="Device Details" 
                                        Command="{Binding ShowDeviceDetailsCommand}"
                                        CommandParameter="{Binding SelectedDevice}">
                                    <MenuItem.Icon>
                                        <materialDesign:PackIcon Kind="InformationOutline" />
                                    </MenuItem.Icon>
                                </MenuItem>
                            </ContextMenu>
                        </DataGrid.ContextMenu>
                    </DataGrid>
                </Grid>
            </materialDesign:Card>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" 
                        HorizontalAlignment="Stretch" 
                        Background="{DynamicResource MaterialDesignDivider}" />

            <!-- Device Details Panel -->
            <materialDesign:Card Grid.Column="2" Visibility="{Binding SelectedDevice, Converter={StaticResource NullToVisibilityConverter}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Details Header -->
                    <materialDesign:ColorZone Grid.Row="0" Mode="PrimaryLight" Padding="15,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            
                            <ContentPresenter Grid.Column="0" 
                                            Content="{Binding SelectedDevice}" 
                                            ContentTemplate="{StaticResource DeviceTypeIconTemplate}"
                                            VerticalAlignment="Center"
                                            Margin="0,0,10,0" />
                            
                            <TextBlock Grid.Column="1" Text="Device Details" 
                                     FontSize="14" FontWeight="SemiBold" 
                                     VerticalAlignment="Center" />
                            
                            <Ellipse Grid.Column="2" 
                                   Width="12" Height="12" 
                                   Style="{StaticResource DeviceStatusStyle}"
                                   DataContext="{Binding SelectedDevice}" />
                        </Grid>
                    </materialDesign:ColorZone>

                    <!-- Device Information -->
                    <ScrollViewer Grid.Row="1" Margin="15">
                        <StackPanel DataContext="{Binding SelectedDevice}">
                            <!-- Basic Info -->
                            <TextBlock Text="Basic Information" 
                                     FontWeight="SemiBold" 
                                     FontSize="14" 
                                     Margin="0,0,0,10" />
                            
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="IP Address:" FontWeight="SemiBold" Margin="0,2,10,2" />
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding IPAddressString}" Margin="0,2" />

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="MAC Address:" FontWeight="SemiBold" Margin="0,2,10,2" />
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding MacAddress}" Margin="0,2" />

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Hostname:" FontWeight="SemiBold" Margin="0,2,10,2" />
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding HostName}" Margin="0,2" />

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="NetBIOS:" FontWeight="SemiBold" Margin="0,2,10,2" />
                                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding NetBiosName}" Margin="0,2" />

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Vendor:" FontWeight="SemiBold" Margin="0,2,10,2" />
                                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding Vendor}" Margin="0,2" />

                                <TextBlock Grid.Row="5" Grid.Column="0" Text="Device Type:" FontWeight="SemiBold" Margin="0,2,10,2" />
                                <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding DeviceType}" Margin="0,2" />

                                <TextBlock Grid.Row="6" Grid.Column="0" Text="Response Time:" FontWeight="SemiBold" Margin="0,2,10,2" />
                                <TextBlock Grid.Row="6" Grid.Column="1" Text="{Binding ResponseTimeText}" Margin="0,2" />
                            </Grid>

                            <!-- Network Info -->
                            <TextBlock Text="Network Information" 
                                     FontWeight="SemiBold" 
                                     FontSize="14" 
                                     Margin="0,10,0,10" />
                            
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Status:" FontWeight="SemiBold" Margin="0,2,10,2" />
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding StatusText}" Margin="0,2" />

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Operating System:" FontWeight="SemiBold" Margin="0,2,10,2" />
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding OperatingSystem}" Margin="0,2" />

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="First Seen:" FontWeight="SemiBold" Margin="0,2,10,2" />
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding FirstSeen, StringFormat='yyyy-MM-dd HH:mm:ss'}" Margin="0,2" />

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Last Seen:" FontWeight="SemiBold" Margin="0,2,10,2" />
                                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding LastSeen, StringFormat='yyyy-MM-dd HH:mm:ss'}" Margin="0,2" />
                            </Grid>

                            <!-- Open Ports -->
                            <TextBlock Text="Open Ports" 
                                     FontWeight="SemiBold" 
                                     FontSize="14" 
                                     Margin="0,10,0,10"
                                     Visibility="{Binding OpenPorts.Count, Converter={StaticResource CountToVisibilityConverter}}" />
                            
                            <ItemsControl ItemsSource="{Binding OpenPorts}" 
                                        Margin="0,0,0,15"
                                        Visibility="{Binding OpenPorts.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{DynamicResource MaterialDesignChipBackground}"
                                              CornerRadius="12"
                                              Padding="8,4"
                                              Margin="2">
                                            <TextBlock Text="{Binding}" 
                                                     FontSize="11" 
                                                     Foreground="{DynamicResource MaterialDesignBody}" />
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- Services -->
                            <TextBlock Text="Detected Services" 
                                     FontWeight="SemiBold" 
                                     FontSize="14" 
                                     Margin="0,10,0,10"
                                     Visibility="{Binding Services.Count, Converter={StaticResource CountToVisibilityConverter}}" />
                            
                            <ItemsControl ItemsSource="{Binding Services}" 
                                        Margin="0,0,0,15"
                                        Visibility="{Binding Services.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" 
                                                 Margin="0,2" 
                                                 FontSize="12" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- Notes -->
                            <TextBlock Text="Notes" 
                                     FontWeight="SemiBold" 
                                     FontSize="14" 
                                     Margin="0,10,0,10" />
                            
                            <TextBox Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}"
                                   AcceptsReturn="True"
                                   TextWrapping="Wrap"
                                   Height="60"
                                   materialDesign:HintAssist.Hint="Add custom notes about this device..." />
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Device Actions -->
                    <UniformGrid Grid.Row="2" Rows="2" Margin="15">
                        <Button Command="{Binding PingDeviceCommand}"
                              CommandParameter="{Binding SelectedDevice}"
                              Content="Ping"
                              Margin="2"
                              Style="{StaticResource MaterialDesignOutlinedButton}" />
                        
                        <Button Command="{Binding WakeOnLanCommand}"
                              CommandParameter="{Binding SelectedDevice}"
                              Content="Wake"
                              Margin="2"
                              Style="{StaticResource MaterialDesignOutlinedButton}" />
                        
                        <Button Command="{Binding TraceRouteCommand}"
                              CommandParameter="{Binding SelectedDevice}"
                              Content="Trace"
                              Margin="2"
                              Style="{StaticResource MaterialDesignOutlinedButton}" />
                        
                        <Button Command="{Binding PortScanCommand}"
                              CommandParameter="{Binding SelectedDevice}"
                              Content="Ports"
                              Margin="2"
                              Style="{StaticResource MaterialDesignOutlinedButton}" />
                    </UniformGrid>
                </Grid>
            </materialDesign:Card>
        </Grid>

        <!-- Status Bar -->
        <materialDesign:Card Grid.Row="3" Margin="10" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="{Binding ScanStatusText}" VerticalAlignment="Center" />
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="20,0">
                    <CheckBox Content="Auto Refresh" 
                            IsChecked="{Binding AutoRefreshEnabled}" 
                            Margin="0,0,10,0" />
                    
                    <TextBlock Text="Interval:" VerticalAlignment="Center" Margin="0,0,5,0" />
                    <TextBox Text="{Binding AutoRefreshInterval}" 
                           Width="40" 
                           VerticalAlignment="Center" 
                           Margin="0,0,5,0" />
                    <TextBlock Text="sec" VerticalAlignment="Center" />
                </StackPanel>

                <TextBlock Grid.Column="2" VerticalAlignment="Center">
                    <Run Text="Last Scan: " />
                    <Run Text="{Binding LastScanTime, StringFormat='HH:mm:ss', TargetNullValue='Never'}" FontWeight="Bold" />
                    <Run Text=" | Duration: " />
                    <Run Text="{Binding ScanDuration, StringFormat='hh\\:mm\\:ss'}" FontWeight="Bold" />
                </TextBlock>
            </Grid>
        </materialDesign:Card>
    </Grid>
</UserControl>
