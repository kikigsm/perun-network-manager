<UserControl x:Class="PerunNetworkManager.Views.DiagnosticToolsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:PerunNetworkManager.Converters"
             xmlns:vm="clr-namespace:PerunNetworkManager.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200"
             d:DataContext="{d:DesignInstance Type=vm:DiagnosticToolsViewModel}">
    
    <UserControl.Resources>
        <converters:BooleanToBrushConverter x:Key="StatusColorConverter" 
                                           TrueBrush="#4CAF50" 
                                           FalseBrush="#F44336" />
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        
        <Style x:Key="ToolHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="Margin" Value="0,0,0,8" />
        </Style>

        <Style x:Key="ResultTextStyle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Consolas, Courier New" />
            <Setter Property="FontSize" Value="12" />
        </Style>
    </UserControl.Resources>

    <Grid>
        <!-- Main Tab Control -->
        <materialDesign:Card Margin="8">
            <TabControl Style="{StaticResource MaterialDesignNavigationRailTabControl}"
                        SelectedIndex="{Binding SelectedToolIndex}">
                
                <!-- Ping Tab -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel>
                            <materialDesign:PackIcon Kind="Pulse" Width="24" Height="24" />
                            <TextBlock Text="Ping" Margin="0,4,0,0" />
                        </StackPanel>
                    </TabItem.Header>

                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <TextBlock Grid.Row="0" Text="Ping" Style="{StaticResource ToolHeaderStyle}" />

                        <!-- Input Section -->
                        <materialDesign:Card Grid.Row="1" Padding="16" Margin="0,0,0,16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!-- Target Input -->
                                <TextBox Grid.Row="0" Grid.Column="0"
                                         Text="{Binding PingTarget, UpdateSourceTrigger=PropertyChanged}"
                                         materialDesign:HintAssist.Hint="Host name or IP address"
                                         materialDesign:TextFieldAssist.HasClearButton="True"
                                         Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                         Margin="0,0,16,0" />

                                <Button Grid.Row="0" Grid.Column="1"
                                        Command="{Binding StartPingCommand}"
                                        Style="{StaticResource MaterialDesignRaisedButton}"
                                        IsEnabled="{Binding IsPinging, Converter={StaticResource InverseBooleanConverter}}"
                                        Width="100">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Play" Margin="0,0,8,0" />
                                        <TextBlock Text="Start" />
                                    </StackPanel>
                                </Button>

                                <!-- Options -->
                                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                                           Orientation="Horizontal" Margin="0,16,0,0">
                                    <CheckBox IsChecked="{Binding PingContinuous}"
                                              Content="Continuous"
                                              Margin="0,0,24,0" />
                                    
                                    <TextBlock Text="Count:" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <materialDesign:NumericUpDown Value="{Binding PingCount}"
                                                                Minimum="1" Maximum="1000"
                                                                Width="80"
                                                                IsEnabled="{Binding PingContinuous, Converter={StaticResource InverseBooleanConverter}}"
                                                                Margin="0,0,24,0" />
                                    
                                    <TextBlock Text="Size (bytes):" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <materialDesign:NumericUpDown Value="{Binding PingSize}"
                                                                Minimum="32" Maximum="65500"
                                                                Width="100"
                                                                Margin="0,0,24,0" />
                                    
                                    <TextBlock Text="Timeout (ms):" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <materialDesign:NumericUpDown Value="{Binding PingTimeout}"
                                                                Minimum="100" Maximum="60000"
                                                                Width="100" />
                                </StackPanel>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Results Section -->
                        <materialDesign:Card Grid.Row="2" Padding="16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!-- Results Text -->
                                <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                                    <TextBox Text="{Binding PingResults}"
                                             Style="{StaticResource ResultTextStyle}"
                                             IsReadOnly="True"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             TextWrapping="NoWrap"
                                             FontFamily="Consolas" />
                                </ScrollViewer>

                                <!-- Statistics -->
                                <Border Grid.Row="1" 
                                       BorderBrush="{DynamicResource MaterialDesignDivider}"
                                       BorderThickness="0,1,0,0"
                                       Margin="0,16,0,0"
                                       Padding="0,16,0,0"
                                       Visibility="{Binding PingStatistics, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="Packets" Style="{StaticResource MaterialDesignCaptionTextBlock}" />
                                            <TextBlock Text="{Binding PingStatistics.PacketsSent, StringFormat='Sent: {0}'}" />
                                            <TextBlock Text="{Binding PingStatistics.PacketsReceived, StringFormat='Received: {0}'}" />
                                            <TextBlock Text="{Binding PingStatistics.PacketsLost, StringFormat='Lost: {0}'}" />
                                        </StackPanel>

                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="Round Trip Time" Style="{StaticResource MaterialDesignCaptionTextBlock}" />
                                            <TextBlock Text="{Binding PingStatistics.MinimumRtt, StringFormat='Min: {0}ms'}" />
                                            <TextBlock Text="{Binding PingStatistics.MaximumRtt, StringFormat='Max: {0}ms'}" />
                                            <TextBlock Text="{Binding PingStatistics.AverageRtt, StringFormat='Avg: {0:F1}ms'}" />
                                        </StackPanel>

                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="Performance" Style="{StaticResource MaterialDesignCaptionTextBlock}" />
                                            <TextBlock Text="{Binding PingStatistics.PacketLossPercentage, StringFormat='Loss: {0:F1}%'}" />
                                            <TextBlock Text="{Binding PingStatistics.Jitter, StringFormat='Jitter: {0:F1}ms'}" />
                                        </StackPanel>

                                        <StackPanel Grid.Column="3" VerticalAlignment="Center">
                                            <Button Command="{Binding StopPingCommand}"
                                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                                    IsEnabled="{Binding IsPinging}"
                                                    Width="100">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="Stop" Margin="0,0,8,0" />
                                                    <TextBlock Text="Stop" />
                                                </StackPanel>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Action Buttons -->
                        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
                            <Button Command="{Binding ClearResultsCommand}"
                                    Style="{StaticResource MaterialDesignFlatButton}"
                                    Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Clear" Margin="0,0,8,0" />
                                    <TextBlock Text="Clear" />
                                </StackPanel>
                            </Button>

                            <Button Command="{Binding ExportResultsCommand}"
                                    Style="{StaticResource MaterialDesignFlatButton}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Export" Margin="0,0,8,0" />
                                    <TextBlock Text="Export" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <!-- Traceroute Tab -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel>
                            <materialDesign:PackIcon Kind="MapMarkerPath" Width="24" Height="24" />
                            <TextBlock Text="Traceroute" Margin="0,4,0,0" />
                        </StackPanel>
                    </TabItem.Header>

                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <TextBlock Grid.Row="0" Text="Traceroute" Style="{StaticResource ToolHeaderStyle}" />

                        <!-- Input Section -->
                        <materialDesign:Card Grid.Row="1" Padding="16" Margin="0,0,0,16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!-- Target Input -->
                                <TextBox Grid.Row="0" Grid.Column="0"
                                         Text="{Binding TracerouteTarget, UpdateSourceTrigger=PropertyChanged}"
                                         materialDesign:HintAssist.Hint="Destination host or IP"
                                         materialDesign:TextFieldAssist.HasClearButton="True"
                                         Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                         Margin="0,0,16,0" />

                                <Button Grid.Row="0" Grid.Column="1"
                                        Command="{Binding StartTracerouteCommand}"
                                        Style="{StaticResource MaterialDesignRaisedButton}"
                                        IsEnabled="{Binding IsTracerouting, Converter={StaticResource InverseBooleanConverter}}"
                                        Width="100">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Play" Margin="0,0,8,0" />
                                        <TextBlock Text="Trace" />
                                    </StackPanel>
                                </Button>

                                <!-- Options -->
                                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                                           Orientation="Horizontal" Margin="0,16,0,0">
                                    <TextBlock Text="Max Hops:" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <materialDesign:NumericUpDown Value="{Binding MaxHops}"
                                                                Minimum="1" Maximum="255"
                                                                Width="80"
                                                                Margin="0,0,24,0" />
                                    
                                    <TextBlock Text="Timeout (ms):" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <materialDesign:NumericUpDown Value="{Binding TracerouteTimeout}"
                                                                Minimum="100" Maximum="60000"
                                                                Width="100"
                                                                Margin="0,0,24,0" />
                                    
                                    <CheckBox IsChecked="{Binding ResolveHostnames}"
                                              Content="Resolve hostnames" />
                                </StackPanel>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Results Section -->
                        <materialDesign:Card Grid.Row="2" Padding="16">
                            <Grid>
                                <DataGrid ItemsSource="{Binding TracerouteHops}"
                                          AutoGenerateColumns="False"
                                          CanUserAddRows="False"
                                          IsReadOnly="True"
                                          GridLinesVisibility="None"
                                          HeadersVisibility="Column">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Hop" 
                                                           Binding="{Binding HopNumber}" 
                                                           Width="50" />
                                        <DataGridTextColumn Header="RTT 1" 
                                                           Binding="{Binding Rtt1, StringFormat='{}{0}ms'}" 
                                                           Width="80" />
                                        <DataGridTextColumn Header="RTT 2" 
                                                           Binding="{Binding Rtt2, StringFormat='{}{0}ms'}" 
                                                           Width="80" />
                                        <DataGridTextColumn Header="RTT 3" 
                                                           Binding="{Binding Rtt3, StringFormat='{}{0}ms'}" 
                                                           Width="80" />
                                        <DataGridTextColumn Header="IP Address" 
                                                           Binding="{Binding IPAddress}" 
                                                           Width="150" />
                                        <DataGridTextColumn Header="Hostname" 
                                                           Binding="{Binding Hostname}" 
                                                           Width="*" />
                                    </DataGrid.Columns>
                                </DataGrid>
                                
                                <!-- Loading/Status Overlay -->
                                <Grid Visibility="{Binding IsTracerouting, Converter={StaticResource BooleanToVisibilityConverter}}"
                                      Background="#80000000">
                                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                                    Value="0"
                                                    IsIndeterminate="True"
                                                    Width="50" Height="50" />
                                        <TextBlock Text="{Binding TracerouteStatus}"
                                                  Foreground="White"
                                                  Margin="0,16,0,0"
                                                  HorizontalAlignment="Center" />
                                        <Button Command="{Binding StopTracerouteCommand}"
                                                Style="{StaticResource MaterialDesignFlatButton}"
                                                Foreground="White"
                                                Margin="0,16,0,0">
                                            Cancel
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </materialDesign:Card>
                    </Grid>
                </TabItem>

                <!-- Port Scan Tab -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel>
                            <materialDesign:PackIcon Kind="NetworkOutline" Width="24" Height="24" />
                            <TextBlock Text="Port Scan" Margin="0,4,0,0" />
                        </StackPanel>
                    </TabItem.Header>

                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <TextBlock Grid.Row="0" Text="Port Scanner" Style="{StaticResource ToolHeaderStyle}" />

                        <!-- Input Section -->
                        <materialDesign:Card Grid.Row="1" Padding="16" Margin="0,0,0,16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!-- Target Input -->
                                <TextBox Grid.Row="0" Grid.Column="0"
                                         Text="{Binding PortScanTarget, UpdateSourceTrigger=PropertyChanged}"
                                         materialDesign:HintAssist.Hint="Target host or IP"
                                         materialDesign:TextFieldAssist.HasClearButton="True"
                                         Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                         Margin="0,0,16,0" />

                                <Button Grid.Row="0" Grid.Column="1"
                                        Command="{Binding StartPortScanCommand}"
                                        Style="{StaticResource MaterialDesignRaisedButton}"
                                        IsEnabled="{Binding IsPortScanning, Converter={StaticResource InverseBooleanConverter}}"
                                        Width="100">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Scan" Margin="0,0,8,0" />
                                        <TextBlock Text="Scan" />
                                    </StackPanel>
                                </Button>

                                <!-- Port Range -->
                                <Grid Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,16,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <RadioButton Grid.Column="0"
                                                GroupName="PortRange"
                                                IsChecked="{Binding UseCommonPorts}"
                                                Content="Common ports"
                                                Margin="0,0,16,0" />
                                    
                                    <RadioButton Grid.Column="2"
                                                GroupName="PortRange"
                                                IsChecked="{Binding UseCommonPorts, Converter={StaticResource InverseBooleanConverter}}"
                                                Content="Custom range:"
                                                Margin="16,0,8,0" />
                                    
                                    <TextBox Grid.Column="3"
                                             Text="{Binding PortRange}"
                                             materialDesign:HintAssist.Hint="e.g., 1-1000 or 80,443,8080"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             IsEnabled="{Binding UseCommonPorts, Converter={StaticResource InverseBooleanConverter}}"
                                             Margin="0,0,0,0" />
                                </Grid>

                                <!-- Scan Options -->
                                <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" 
                                           Orientation="Horizontal" Margin="0,16,0,0">
                                    <TextBlock Text="Timeout (ms):" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <materialDesign:NumericUpDown Value="{Binding PortScanTimeout}"
                                                                Minimum="100" Maximum="5000"
                                                                Width="100"
                                                                Margin="0,0,24,0" />
                                    
                                    <TextBlock Text="Threads:" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <materialDesign:NumericUpDown Value="{Binding ScanThreads}"
                                                                Minimum="1" Maximum="100"
                                                                Width="80"
                                                                Margin="0,0,24,0" />
                                    
                                    <CheckBox IsChecked="{Binding PerformServiceDetection}"
                                              Content="Detect services" />
                                </StackPanel>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Results Section -->
                        <materialDesign:Card Grid.Row="2" Padding="16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <!-- Progress Bar -->
                                <ProgressBar Grid.Row="0"
                                            Value="{Binding PortScanProgress}"
                                            Visibility="{Binding IsPortScanning, Converter={StaticResource BooleanToVisibilityConverter}}"
                                            Margin="0,0,0,16" />

                                <!-- Results -->
                                <DataGrid Grid.Row="1"
                                         ItemsSource="{Binding OpenPorts}"
                                         AutoGenerateColumns="False"
                                         CanUserAddRows="False"
                                         IsReadOnly="True"
                                         GridLinesVisibility="None"
                                         HeadersVisibility="Column">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Port" 
                                                           Binding="{Binding Port}" 
                                                           Width="80" />
                                        <DataGridTextColumn Header="Protocol" 
                                                           Binding="{Binding Protocol}" 
                                                           Width="80" />
                                        <DataGridTextColumn Header="State" 
                                                           Binding="{Binding State}" 
                                                           Width="100" />
                                        <DataGridTextColumn Header="Service" 
                                                           Binding="{Binding Service}" 
                                                           Width="150" />
                                        <DataGridTextColumn Header="Version" 
                                                           Binding="{Binding Version}" 
                                                           Width="*" />
                                    </DataGrid.Columns>
                                    
                                    <DataGrid.RowStyle>
                                        <Style TargetType="DataGridRow" BasedOn="{StaticResource MaterialDesignDataGridRow}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding State}" Value="Open">
                                                    <Setter Property="Foreground" Value="#4CAF50" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding State}" Value="Filtered">
                                                    <Setter Property="Foreground" Value="#FF9800" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGrid.RowStyle>
                                </DataGrid>

                                <!-- Empty State -->
                                <TextBlock Grid.Row="1"
                                          Text="No open ports found"
                                          Visibility="{Binding OpenPorts.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=0}"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center"
                                          Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                                          Foreground="{StaticResource MaterialDesignBodyLight}" />
                            </Grid>
                        </materialDesign:Card>
                    </Grid>
                </TabItem>

                <!-- DNS Lookup Tab -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel>
                            <materialDesign:PackIcon Kind="Dns" Width="24" Height="24" />
                            <TextBlock Text="DNS Lookup" Margin="0,4,0,0" />
                        </StackPanel>
                    </TabItem.Header>

                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <TextBlock Grid.Row="0" Text="DNS Lookup" Style="{StaticResource ToolHeaderStyle}" />

                        <!-- Input Section -->
                        <materialDesign:Card Grid.Row="1" Padding="16" Margin="0,0,0,16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!-- Query Input -->
                                <TextBox Grid.Row="0" Grid.Column="0"
                                         Text="{Binding DnsQuery, UpdateSourceTrigger=PropertyChanged}"
                                         materialDesign:HintAssist.Hint="Domain name or IP address"
                                         materialDesign:TextFieldAssist.HasClearButton="True"
                                         Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                         Margin="0,0,16,0" />

                                <Button Grid.Row="0" Grid.Column="1"
                                        Command="{Binding PerformDnsLookupCommand}"
                                        Style="{StaticResource MaterialDesignRaisedButton}"
                                        Width="100">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Search" Margin="0,0,8,0" />
                                        <TextBlock Text="Lookup" />
                                    </StackPanel>
                                </Button>

                                <!-- Options -->
                                <Grid Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,16,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="150" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" 
                                              Text="Record Type:" 
                                              VerticalAlignment="Center" 
                                              Margin="0,0,8,0" />
                                    
                                    <ComboBox Grid.Column="1"
                                              ItemsSource="{Binding DnsRecordTypes}"
                                              SelectedItem="{Binding SelectedRecordType}"
                                              Margin="0,0,24,0" />
                                    
                                    <TextBlock Grid.Column="2"
                                              Text="DNS Server:" 
                                              VerticalAlignment="Center" 
                                              Margin="0,0,8,0" />
                                    
                                    <TextBox Grid.Column="3"
                                             Text="{Binding CustomDnsServer}"
                                             materialDesign:HintAssist.Hint="Optional (e.g., 8.8.8.8)"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}" />
                                </Grid>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Results Section -->
                        <materialDesign:Card Grid.Row="2" Padding="16">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel>
                                    <!-- Query Information -->
                                    <Border BorderBrush="{DynamicResource MaterialDesignDivider}"
                                           BorderThickness="0,0,0,1"
                                           Padding="0,0,0,16"
                                           Margin="0,0,0,16"
                                           Visibility="{Binding DnsResults, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>

                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Query:" Margin="0,0,16,4" FontWeight="Medium" />
                                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding DnsResults.Query}" Margin="0,0,0,4" />

                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Type:" Margin="0,0,16,4" FontWeight="Medium" />
                                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding DnsResults.QueryType}" Margin="0,0,0,4" />

                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Server:" Margin="0,0,16,0" FontWeight="Medium" />
                                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding DnsResults.DnsServer}" />
                                        </Grid>
                                    </Border>

                                    <!-- DNS Records -->
                                    <ItemsControl ItemsSource="{Binding DnsResults.Records}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border BorderBrush="{DynamicResource MaterialDesignDivider}"
                                                       BorderThickness="0,0,0,1"
                                                       Padding="0,0,0,8"
                                                       Margin="0,0,0,8">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="100" />
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="80" />
                                                        </Grid.ColumnDefinitions>

                                                        <TextBlock Grid.Column="0" 
                                                                  Text="{Binding Type}" 
                                                                  FontWeight="Medium" />
                                                        <TextBlock Grid.Column="1" 
                                                                  Text="{Binding Value}" 
                                                                  TextWrapping="Wrap" />
                                                        <TextBlock Grid.Column="2" 
                                                                  Text="{Binding TTL, StringFormat='TTL: {0}'}" 
                                                                  HorizontalAlignment="Right"
                                                                  Style="{StaticResource MaterialDesignCaptionTextBlock}" />
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </ScrollViewer>
                        </materialDesign:Card>
                    </Grid>
                </TabItem>

                <!-- Network Statistics Tab -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel>
                            <materialDesign:PackIcon Kind="ChartLine" Width="24" Height="24" />
                            <TextBlock Text="Statistics" Margin="0,4,0,0" />
                        </StackPanel>
                    </TabItem.Header>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <Grid Margin="16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- Header -->
                            <TextBlock Grid.Row="0" Text="Network Statistics" Style="{StaticResource ToolHeaderStyle}" />

                            <!-- Interface Statistics -->
                            <materialDesign:Card Grid.Row="1" Padding="16" Margin="0,0,0,16">
                                <StackPanel>
                                    <TextBlock Text="Interface Statistics" FontSize="16" FontWeight="Medium" Margin="0,0,0,16" />
                                    
                                    <ComboBox ItemsSource="{Binding NetworkInterfaces}"
                                              SelectedItem="{Binding SelectedInterface}"
                                              DisplayMemberPath="Name"
                                              materialDesign:HintAssist.Hint="Select Network Interface"
                                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                              Margin="0,0,0,16" />

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <!-- Sent Statistics -->
                                        <StackPanel Grid.Column="0" Margin="0,0,16,0">
                                            <TextBlock Text="Sent" FontWeight="Medium" Margin="0,0,0,8" />
                                            <TextBlock Text="{Binding InterfaceStats.BytesSent, Converter={StaticResource BytesToStringConverter}}" />
                                            <TextBlock Text="{Binding InterfaceStats.PacketsSent, StringFormat='Packets: {0:N0}'}" />
                                            <TextBlock Text="{Binding InterfaceStats.ErrorsSent, StringFormat='Errors: {0:N0}'}" />
                                            <TextBlock Text="{Binding InterfaceStats.DiscardedSent, StringFormat='Discarded: {0:N0}'}" />
                                        </StackPanel>

                                        <!-- Received Statistics -->
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="Received" FontWeight="Medium" Margin="0,0,0,8" />
                                            <TextBlock Text="{Binding InterfaceStats.BytesReceived, Converter={StaticResource BytesToStringConverter}}" />
                                            <TextBlock Text="{Binding InterfaceStats.PacketsReceived, StringFormat='Packets: {0:N0}'}" />
                                            <TextBlock Text="{Binding InterfaceStats.ErrorsReceived, StringFormat='Errors: {0:N0}'}" />
                                            <TextBlock Text="{Binding InterfaceStats.DiscardedReceived, StringFormat='Discarded: {0:N0}'}" />
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </materialDesign:Card>

                            <!-- Protocol Statistics -->
                            <materialDesign:Card Grid.Row="2" Padding="16" Margin="0,0,0,16">
                                <StackPanel>
                                    <TextBlock Text="Protocol Statistics" FontSize="16" FontWeight="Medium" Margin="0,0,0,16" />
                                    
                                    <DataGrid ItemsSource="{Binding ProtocolStats}"
                                              AutoGenerateColumns="False"
                                              CanUserAddRows="False"
                                              IsReadOnly="True"
                                              MaxHeight="300">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Protocol" Binding="{Binding Protocol}" Width="100" />
                                            <DataGridTextColumn Header="Connections" Binding="{Binding Connections}" Width="100" />
                                            <DataGridTextColumn Header="Sent" Binding="{Binding BytesSent, Converter={StaticResource BytesToStringConverter}}" Width="120" />
                                            <DataGridTextColumn Header="Received" Binding="{Binding BytesReceived, Converter={StaticResource BytesToStringConverter}}" Width="120" />
                                            <DataGridTextColumn Header="Errors" Binding="{Binding Errors}" Width="80" />
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </materialDesign:Card>

                            <!-- Active Connections -->
                            <materialDesign:Card Grid.Row="3" Padding="16">
                                <StackPanel>
                                    <Grid>
                                        <TextBlock Text="Active Connections" FontSize="16" FontWeight="Medium" />
                                        <Button Command="{Binding RefreshConnectionsCommand}"
                                                Style="{StaticResource MaterialDesignToolButton}"
                                                HorizontalAlignment="Right"
                                                ToolTip="Refresh">
                                            <materialDesign:PackIcon Kind="Refresh" />
                                        </Button>
                                    </Grid>
                                    
                                    <DataGrid ItemsSource="{Binding ActiveConnections}"
                                              AutoGenerateColumns="False"
                                              CanUserAddRows="False"
                                              IsReadOnly="True"
                                              MaxHeight="400"
                                              Margin="0,16,0,0">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Protocol" Binding="{Binding Protocol}" Width="80" />
                                            <DataGridTextColumn Header="Local Address" Binding="{Binding LocalEndpoint}" Width="150" />
                                            <DataGridTextColumn Header="Remote Address" Binding="{Binding RemoteEndpoint}" Width="150" />
                                            <DataGridTextColumn Header="State" Binding="{Binding State}" Width="100" />
                                            <DataGridTextColumn Header="Process" Binding="{Binding ProcessName}" Width="*" />
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </materialDesign:Card>
                        </Grid>
                    </ScrollViewer>
                </TabItem>
            </TabControl>
        </materialDesign:Card>

        <!-- Snackbar for notifications -->
        <materialDesign:Snackbar x:Name="DiagnosticSnackbar"
                                MessageQueue="{materialDesign:MessageQueue}" />
    </Grid>
</UserControl>" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto
